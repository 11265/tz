name: Build iOS Kernel Extension

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Xcode
      run: |
        sudo xcode-select -s /Applications/Xcode.app

    - name: Install Dependencies
      run: |
        brew install cmake # 如果你的构建需要其他工具或依赖，请在这里安装

    - name: Build Kernel Extension
      run: |
        # 进入内核扩展的目录
        cd kext  # 确保这里的路径与仓库中的实际目录匹配

        # 创建构建目录
        mkdir -p build
        cd build

        # 运行 cmake 和 make 编译
        cmake ..
        make

    - name: Sign Kernel Extension
      run: |
        # 替换为你的签名证书名称
        sudo codesign -s "iPhone Developer: Your Name (XXXXXXXXXX)" --force build/YourKext.kext

    - name: Upload Kernel Extension
      uses: actions/upload-artifact@v2
      with:
        name: ios-kernel-extension
        path: kext/build/YourKext.kext
